---
title: Фильтрация треков GPS на языке программирования F#, Часть I
date: "2019-02-21 12:00:00 +0300"
id: fsharp-gps-tracks-filtration-1
excerpt: Лекция, прочитанная в Московском клубе программистов 21 февраля 2019 года.
---

## Проблематика

На рисунке показан типичный GPS-трек.

![Фильрация треков GPS](/img/gps-track-filtering-1.png)

Чёрным цветом нарисован реальный путь автомобиля или человека, а синим&nbsp;&mdash; координаты, полученные с датчика GPS. Как видим, пути не сильно совпадают. Если вы хотите вычислить скорость и пройденное расстояние, точность ваших вычислений окажется невысокой.

Мы поговорим о методах, которые помогут превратить синюю линию в красную. Красная лииня&nbsp;&mdash; это приближение, вычисленное на основании реальных синих точек.

В качестве языка реализации я выбрал F#. Во-первых потому, что это интересно. Во-вторых, написанный мной код работает и на сервере в Azure, и в мобильном Xamarin-приложении. F#, как и другие языки .NET, живёт на разных платформах.

## Данные GPS

Мобильные телефоны оснащены разными датчиками, и позволяют &laquo;снимать&raquo; не только положение устройства, но и его ориентацию, и ускорение. Нам для наших целей понадобятся:

1. *Широта* и *долгота* (*latitude* и *longitude*)&nbsp;&mdash; координаты устройства. Измеряются в градусах.
1. *Метка времени* (*timestamp*)&nbsp;&mdash; дата и время получения координаты.
1. *Скорость* (*speed*). Измеряется в метрах в секунду.
1. *Направление* (*heading*)&nbsp;&mdash; направление движения относительно Севера. Измеряется в градусах, положительное направление по часовой стрелке.

## Этапы обработки трека

Обработка трека состоит из трёх стадий: *стабилизации*, *сглаживания* и *прореживания*. В этой заметки мы обсудим первый этап&nbsp;&mdash; стабилизацию.

Стабилизация позволяет избавиться от некорректных точек трека, не изменяя оставшихся корректных.


### Удаление нулевых и негативных интервалов времени

Removing Data with Duplicate/Negative Time Records.

### Устранение дрейфа нулевой скорости

Нулевая скорость должна быть нулевой, поэтому, пока автомобиль стоит на одном месте, датчик GPS должен возвращать одни и те же координаты. Логично?

Не совсем. Из-за погрешностей измерения, датчик GPS может давать близкие, но разные координаты, даже если автомобиль остановился. Скорость этих микроперемещений невысока и составляет 100-200 метров в час. Небольшое, но постоянное её изменение называется *дрифтом нулевой скорости*.

Для стабилизации, мы можем вычислять скорость микроперемещения и сравнивать её с константной, значение которой подбираем вручную. Мы можем отбрасывать слишком медленные микроперемещения, полагая, что они вызваны дрифтом нулевой скорости.

Следующий этап стабилизации&nbsp;&mdash; *устранение дрейфа нулевой скорости*. Когда автомобиль длительное время стоит на одном месте, датчик GPS продолжает получать координаты

На третьем этапе процесса фильтрации устраняется эффект, называемый дрейфом с нулевой скоростью. Дрейф нулевой скорости появляется, когда GPS DAS работает, и автомобиль останавливается и работает на холостом ходу в течение длительного периода времени. Во время событий простоя длительной длительности регистраторы данных GPS часто регистрируют очень малое значение скорости (0,1 или 0,2 мили в час) из-за повторного получения спутникового сигнала GPS, которое происходит при остановке транспортного средства. Чтобы устранить небольшие колебания скорости автомобиля, зарегистрированные GPS DAS в течение этих периодов, дрейфовый фильтр с нулевой скоростью проверяет расстояние, пройденное за каждую микротрип в цикле движения, и сравнивает значение с заданным пользователем пределом. Если расстояние, пройденное по микротрипу, меньше предела, вся микротрип заменяется значениями данных нулевой скорости.

## Ссылки

[^1] [GPS Data Filtration Method for Drive Cycle Analysis Applications](https://pdfs.semanticscholar.org/3bc3/3f0902565a19a016762ab07ace62a7ca0261.pdf)

[^2] [Фильтр Калмана](https://habr.com/ru/post/166693/)
